<VirtualHost *:80>

  ServerName MMI.sae202.ovh
  ServerAdmin prof@mmi-troyes.fr

  DocumentRoot /var/www/sae202
  DirectoryIndex index.php

        <Directory /var/www/sae202>
                Options Indexes FollowSymlinks
                AllowOverride All
                Require all granted

        #Reecriture des URLs pour le routeur MVC
        
              RewriteEngine On
              RewriteCond %{REQUEST_FILENAME} !-f
              RewriteCond %{REQUEST_FILENAME} !-d
              RewriteRule ^([^/]+) index.php/$1
              
        </Directory>

        # Protection des pages d'administration via le routage MVC
        <LocationMatch "^/gestion">
                AuthType Basic
                AuthBasicProvider file
                AuthName "Administration sae202"
                AuthUserFile "/home/MMI/htpassword.mmi"
                <RequireAny>
                Require ip 195.83.128.43 194.199.63.200 194.199.63.199
                Require valid-user
                </RequireAny>
        </LocationMatch>

        # Protection alternative pour toutes les URLs d'admin
        <LocationMatch "^/(gestion|admin)">
                AuthType Basic
                AuthBasicProvider file
                AuthName "Administration sae202"
                AuthUserFile "/home/MMI/htpassword.mmi"
                <RequireAny>
                Require ip 195.83.128.43 194.199.63.200 194.199.63.199
                Require valid-user
                </RequireAny>
        </LocationMatch>

        # Protection du dossier physique admin (si existant)
        <Directory /var/www/sae202/admin>
                AuthType Basic
                AuthBasicProvider file
                AuthName "Administration sae202"
                AuthUserFile "/home/MMI/htpassword.mmi"
                <RequireAny>
                Require ip 195.83.128.43 194.199.63.200 194.199.63.199
                Require valid-user
                </RequireAny>
        </Directory>

        # Protection du dossier view/admin
        <Directory /var/www/sae202/view/admin>
                AuthType Basic
                AuthBasicProvider file
                AuthName "Administration sae202"
                AuthUserFile "/home/MMI/htpassword.mmi"
                <RequireAny>
                Require ip 195.83.128.43 194.199.63.200 194.199.63.199
                Require valid-user
                </RequireAny>
        </Directory>

</VirtualHost> 