#---------------------------------------------------
# .htaccess – racine du projet /var/www/sae202
#---------------------------------------------------

RewriteEngine On

# --- (1) Redirection HTTPS en production ------------
# Uncomment pour forcer HTTPS
# RewriteCond %{HTTPS} off
# RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# --- (2) Bloquer l'accès direct à conf/ et model/ ---
RewriteRule ^(conf|model)/ - [F,L]

# --- (3) Routage principal vers index.php/<path> ----
# On ignore les vrais fichiers et dossiers
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Tout le reste : on conserve le chemin après index.php
RewriteRule ^(.+)$ index.php/$1 [QSA,L]

# --- (4) Cacher les fichiers commençant par un point -
<Files ~ "^\.">
    Require all denied
</Files>

# --- (5) Cache pour les ressources statiques ----------
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType text/css               "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType image/png              "access plus 1 month"
    ExpiresByType image/jpg              "access plus 1 month"
    ExpiresByType image/jpeg             "access plus 1 month"
    ExpiresByType image/gif              "access plus 1 month"
    ExpiresByType image/ico              "access plus 1 month"
</IfModule>

# --- (6) Compression gzip -----------------------------
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>
